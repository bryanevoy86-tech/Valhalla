type: schedule
name: quarter_hour_smoke
action: upsert
timezone: America/Toronto
cron:
  minute: "*/15"
task:
  type: job
  name: api_smoke
  python: |
    import json, urllib.request
    def hit(url, data=None):
        req = urllib.request.Request(url, data=data and json.dumps(data).encode('utf-8'), headers={'Content-Type':'application/json'} if data else {})
        with urllib.request.urlopen(req, timeout=10) as r:
            print(">>>", url, r.status)
            print(r.read().decode('utf-8')[:200])
    base = "http://api:8000"
    hit(base + "/health")
  timeout: 60
